<div class="max-w-screen-lg mx-auto px-4">
  <div class="grid grid-cols-4 gap-4">
    <div
      *ngFor="let visualiser of visualiser.visualizers"
      [ngClass]="{
        '': visualiser.groupable,
        'col-span-full': !visualiser.groupable
      }"
    >
      <!-- Display the header for the requirement -->
      <div class="text-sm font-semibold !text-slate-600 mb-2">
        {{ visualiser.title }}
      </div>

      <div [ngClass]="{
        '': visualiser.groupable,
        'grid grid-cols-4 gap-4': !visualiser.groupable
      }">

        <!-- Render filled units as cards -->
        <ng-container *ngFor="let unit of visualiser.units()">
          <div>
            <div class="w-full h-8 rounded border border-gray-300 p-3 shadow">
              <div class="text-sm font-semibold text-gray-800 truncate">{{unit.selector!.name}}</div>
              <div class="text-xs text-gray-600">{{unit.cost | number}} Pts</div>
            </div>
          </div>
        </ng-container>

        <!-- Render mandatory slots as buttons -->
        <ng-container *ngFor="let slot of visualiser.slots()">
          <div>
            <button #mandatoryButton
              *ngIf="slot.isMandatory; else optionalButton"
              color="primary"
              class="w-full btn-primary h-8 text-sm shadow"
              [matMenuTriggerFor]="unitMenu"
            >
              Add Unit
            </button>
            <ng-template #optionalButton>
              <button color="primary" class="w-full h-8 text-sm btn bg-gray-100 hover:bg-gray-50 hover:text-primary-800 shadow" [matMenuTriggerFor]="unitMenu" >
                Add Unit <span *ngIf="slot.upToQty > 1">(+{{slot.upToQty}})</span>
              </button>
            </ng-template>
          </div>
          <mat-menu #unitMenu="matMenu" class="!bg-gray-50">
            <button
              mat-menu-item
              *ngFor="let selector of visualiser.availableUnitSelectors"
              (click)="addUnit(visualiser, selector)"
            >
              {{ selector.name }} <!-- Assuming each selector has a 'name' property -->
            </button>
          </mat-menu>
        </ng-container>
      </div>
    </div>
  </div>
</div>

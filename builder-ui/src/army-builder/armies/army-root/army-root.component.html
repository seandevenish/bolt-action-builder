<div class="flex items-center" *ngIf="army() != null && !loading()">

  <h1 class="mb-0 text-md font-semibold text-truncate">{{army()!.name}}</h1>

  <div class="flex items-center ml-auto gap-2">

    <button type="button" mat-icon-button matTooltip="Expand All" aria-label="Expand All" (click)="expandAll()">
      <mat-icon fontIcon="add_circle"></mat-icon>
    </button>

    <button type="button" mat-icon-button matTooltip="Collapse All" aria-label="Collapse All" (click)="collapseAll()">
      <mat-icon fontIcon="remove_circle"></mat-icon>
    </button>

    <button mat-button [matMenuTriggerFor]="menu">
      <mat-icon fontIcon="settings"></mat-icon>
      Settings
    </button>
    <mat-menu #menu="matMenu">
      <button type="button" mat-menu-item (click)="delete()">
        <mat-icon fontIcon="delete"></mat-icon>
        Delete Army
      </button>
    </mat-menu>

    <button type="button" mat-icon-button aria-label="Save Only" matTooltip="Save" class="mr-2" (click)="save(false)">
      <mat-icon *ngIf="saving() != 'saveOnly'" fontIcon="save"></mat-icon>
      <mat-spinner *ngIf="saving() == 'saveOnly'" diameter="20"></mat-spinner>
    </button>

    <button type="button" mat-flat-button (click)="save(true)">
      <mat-spinner *ngIf="saving() == 'saveAndClose'" diameter="20"></mat-spinner>
      <mat-icon fontIcon="save"></mat-icon>
      Save and Close
    </button>

  </div>

</div>

<div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded" role="alert" *ngIf="error">
  <p class="font-bold !mb-0">Error</p>
  <p class="!mb-0">{{error.message ?? error}}</p>
</div>

<mat-progress-bar mode="indeterminate" *ngIf="loading()"></mat-progress-bar>

<div class="mt-3" *ngIf="!loading()">

  <!-- Unit Card - Commander -->

  <mat-accordion cdkDropList [cdkDropListData]="platoons()" (cdkDropListDropped)="drop($event)" [multi]="multiExpand()" #platoonAccordion>
    <mat-expansion-panel *ngFor="let platoon of platoons(); let i = index" cdkDrag #platoonPanel class="!bg-white">
      <mat-expansion-panel-header class="ps-2">
        <mat-panel-title>
          <div class="drag-handle" cdkDragHandle>
            <mat-icon>drag_indicator</mat-icon>
          </div>
          {{ platoon.name }}
        </mat-panel-title>
        <mat-panel-description>
          {{ platoon.platoonName }}
        </mat-panel-description>
      </mat-expansion-panel-header>

      <!-- Load the PlatoonComponent for each platoon -->
      <app-platoon [platoon]="platoon" [unitSelectors]="unitSelectors"></app-platoon>

      <mat-action-row class="!border-t-2 !border-gray-100 space-x-2">
        <button class="flex items-center px-4 py-2 text-primary-700 text-sm rounded hover:bg-primary-100 focus:outline-none focus:ring-2 focus:ring-primary-400" (click)="deletePlatoon(i)">
          <!-- <mat-icon class="text-gray-500 mr-1">delete</mat-icon> -->
          Delete Platoon
        </button>
        <button class="flex items-center px-4 py-2 bg-gray-100 text-primary-700 text-sm rounded hover:bg-primary-100 focus:outline-none focus:ring-2 focus:ring-primary-400" (click)="copyPlatoon(i)">
          <!-- <mat-icon class="text-gray-500 mr-1">content_copy</mat-icon> -->
          Duplicate
        </button>
      </mat-action-row>

    </mat-expansion-panel>

    <!-- Add Platoon Button -->
    <div class="mt-3">
      <button mat-flat-button color="primary" [matMenuTriggerFor]="addPlatoonMenu">
        + Add Platoon
      </button>

      <mat-menu #addPlatoonMenu="matMenu">
        <button mat-menu-item *ngFor="let platoon of platoonSelectors" (click)="addPlatoon(platoon)">
          {{ platoon.name }}
        </button>
      </mat-menu>

    </div>
  </mat-accordion>

</div>
